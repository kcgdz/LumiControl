<Window x:Class="LumiControl.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:vm="clr-namespace:LumiControl.ViewModels"
        xmlns:converters="clr-namespace:LumiControl.Converters"
        mc:Ignorable="d"
        Title="LumiControl"
        Width="480" Height="680"
        MinWidth="420" MinHeight="500"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis" />
        <converters:BrightnessToWidthConverter x:Key="BrightToWidth" />

        <!-- Fade in animation -->
        <Storyboard x:Key="FadeIn">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1" Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeIn}" />
        </EventTrigger>
    </Window.Triggers>

    <!-- Main Container with rounded corners -->
    <Border Background="{StaticResource PrimaryBackgroundBrush}"
            CornerRadius="12"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect Color="Black" BlurRadius="30" ShadowDepth="0" Opacity="0.5" />
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- HEADER / Custom Titlebar -->
            <Border Grid.Row="0" Background="{StaticResource SecondaryBackgroundBrush}"
                    CornerRadius="12,12,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Logo & Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                        <!-- Sun icon -->
                        <TextBlock Text="&#x2600;" FontSize="20" Foreground="{StaticResource AccentLightBrush}"
                                   VerticalAlignment="Center" Margin="0,0,10,0" />
                        <TextBlock Text="LumiControl" FontSize="16" FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Status -->
                    <TextBlock Grid.Column="1" Text="{Binding StatusText}" FontSize="11"
                               Foreground="{StaticResource TextMutedBrush}"
                               HorizontalAlignment="Center" VerticalAlignment="Center" />

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,4,0">
                        <Button Style="{StaticResource IconButton}" Click="MinimizeButton_Click"
                                ToolTip="Minimize">
                            <TextBlock Text="&#x2015;" FontSize="12" />
                        </Button>
                        <Button Style="{StaticResource IconButton}" Click="CloseButton_Click"
                                ToolTip="Close">
                            <TextBlock Text="&#x2715;" FontSize="12" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- MONITOR LIST -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="16,12">
                <StackPanel>
                    <!-- Loading indicator -->
                    <TextBlock Text="Detecting monitors..."
                               Foreground="{StaticResource TextMutedBrush}"
                               FontSize="14" HorizontalAlignment="Center" Margin="0,40,0,0"
                               Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" />

                    <!-- Monitor Cards -->
                    <ItemsControl ItemsSource="{Binding Monitors}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource MonitorCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <!-- Monitor Header -->
                                        <Grid Grid.Row="0" Margin="0,0,0,16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!-- Monitor Icon -->
                                            <Border Grid.Column="0" Width="40" Height="40"
                                                    Background="{StaticResource SecondaryBackgroundBrush}"
                                                    CornerRadius="8" Margin="0,0,12,0">
                                                <TextBlock Text="{Binding MonitorIcon}" FontFamily="Segoe MDL2 Assets"
                                                           FontSize="18" Foreground="{StaticResource AccentLightBrush}"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center" />
                                            </Border>

                                            <!-- Name -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding FriendlyName}" FontSize="14" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimaryBrush}" />
                                                <TextBlock Text="{Binding MonitorSubtitle, Mode=OneWay}" FontSize="11"
                                                           Foreground="{StaticResource TextMutedBrush}" Margin="0,2,0,0" />
                                            </StackPanel>

                                            <!-- Connection Badge -->
                                            <Border Grid.Column="2" Background="{StaticResource AccentDarkBrush}"
                                                    CornerRadius="4" Padding="8,3" VerticalAlignment="Center"
                                                    Margin="0,0,8,0">
                                                <TextBlock Text="{Binding ConnectionBadge}" FontSize="10"
                                                           FontWeight="Bold" Foreground="White" />
                                            </Border>

                                            <!-- Brightness Percentage -->
                                            <TextBlock Grid.Column="3" FontSize="28" FontWeight="Bold"
                                                       Foreground="{StaticResource AccentLightBrush}"
                                                       VerticalAlignment="Center">
                                                <Run Text="{Binding Brightness}" /><Run Text="%" FontSize="16" />
                                            </TextBlock>
                                        </Grid>

                                        <!-- Brightness Slider -->
                                        <Grid Grid.Row="1" Margin="0,4,0,12" x:Name="SliderGrid">
                                            <Slider Minimum="{Binding MinBrightness}" Maximum="{Binding MaxBrightness}"
                                                    Value="{Binding Brightness, Mode=TwoWay, Delay=50}"
                                                    IsSnapToTickEnabled="True" TickFrequency="1"
                                                    Height="32">
                                                <Slider.Template>
                                                    <ControlTemplate TargetType="Slider">
                                                        <Grid VerticalAlignment="Center">
                                                            <!-- Track background -->
                                                            <Border x:Name="TrackBg" Height="8" CornerRadius="4"
                                                                    Background="{StaticResource SecondaryBackgroundBrush}" />
                                                            <!-- Track fill -->
                                                            <Border Height="8" CornerRadius="4" HorizontalAlignment="Left"
                                                                    Background="{StaticResource SliderTrackGradient}">
                                                                <Border.Width>
                                                                    <MultiBinding Converter="{StaticResource BrightToWidth}">
                                                                        <Binding Path="Value" RelativeSource="{RelativeSource TemplatedParent}" />
                                                                        <Binding Path="ActualWidth" ElementName="TrackBg" />
                                                                    </MultiBinding>
                                                                </Border.Width>
                                                            </Border>
                                                            <!-- Slider Track -->
                                                            <Track x:Name="PART_Track">
                                                                <Track.DecreaseRepeatButton>
                                                                    <RepeatButton Command="Slider.DecreaseLarge">
                                                                        <RepeatButton.Template>
                                                                            <ControlTemplate TargetType="RepeatButton">
                                                                                <Border Background="Transparent" />
                                                                            </ControlTemplate>
                                                                        </RepeatButton.Template>
                                                                    </RepeatButton>
                                                                </Track.DecreaseRepeatButton>
                                                                <Track.IncreaseRepeatButton>
                                                                    <RepeatButton Command="Slider.IncreaseLarge">
                                                                        <RepeatButton.Template>
                                                                            <ControlTemplate TargetType="RepeatButton">
                                                                                <Border Background="Transparent" />
                                                                            </ControlTemplate>
                                                                        </RepeatButton.Template>
                                                                    </RepeatButton>
                                                                </Track.IncreaseRepeatButton>
                                                                <Track.Thumb>
                                                                    <Thumb>
                                                                        <Thumb.Template>
                                                                            <ControlTemplate TargetType="Thumb">
                                                                                <Grid>
                                                                                    <Ellipse Fill="{StaticResource AccentBrush}" Width="22" Height="22">
                                                                                        <Ellipse.Effect>
                                                                                            <DropShadowEffect Color="{StaticResource AccentColor}"
                                                                                                              BlurRadius="10" ShadowDepth="0" Opacity="0.6" />
                                                                                        </Ellipse.Effect>
                                                                                    </Ellipse>
                                                                                    <Ellipse Fill="White" Width="8" Height="8" />
                                                                                </Grid>
                                                                            </ControlTemplate>
                                                                        </Thumb.Template>
                                                                    </Thumb>
                                                                </Track.Thumb>
                                                            </Track>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Slider.Template>
                                            </Slider>
                                        </Grid>

                                        <!-- Quick Buttons -->
                                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                            <Button Style="{StaticResource QuickButton}" Content="25%"
                                                    Command="{Binding SetQuickBrightnessCommand}" CommandParameter="25"
                                                    Margin="0,0,6,0" />
                                            <Button Style="{StaticResource QuickButton}" Content="50%"
                                                    Command="{Binding SetQuickBrightnessCommand}" CommandParameter="50"
                                                    Margin="0,0,6,0" />
                                            <Button Style="{StaticResource QuickButton}" Content="75%"
                                                    Command="{Binding SetQuickBrightnessCommand}" CommandParameter="75"
                                                    Margin="0,0,6,0" />
                                            <Button Style="{StaticResource QuickButton}" Content="100%"
                                                    Command="{Binding SetQuickBrightnessCommand}" CommandParameter="100" />
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

            <!-- FOOTER -->
            <Border Grid.Row="2" Background="{StaticResource SecondaryBackgroundBrush}"
                    CornerRadius="0,0,12,12" Padding="16,12">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Master Brightness -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="All Monitors"
                                   Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"
                                   VerticalAlignment="Center" Margin="0,0,12,0" />

                        <Slider Grid.Column="1" Minimum="0" Maximum="100"
                                Value="{Binding MasterBrightness, Mode=TwoWay}"
                                IsSnapToTickEnabled="True" TickFrequency="1"
                                VerticalAlignment="Center" />

                        <TextBlock Grid.Column="2" FontSize="14" FontWeight="Bold"
                                   Foreground="{StaticResource AccentLightBrush}"
                                   VerticalAlignment="Center" Margin="12,0,0,0">
                            <Run Text="{Binding MasterBrightness}" /><Run Text="%" />
                        </TextBlock>
                    </Grid>

                    <!-- Controls Row -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Auto Schedule Toggle -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <ToggleButton Style="{StaticResource ToggleSwitch}"
                                          IsChecked="{Binding IsAutoScheduleEnabled}" />
                            <TextBlock Text="Auto Schedule" Foreground="{StaticResource TextMutedBrush}"
                                       FontSize="11" VerticalAlignment="Center" Margin="8,0,0,0" />
                        </StackPanel>

                        <!-- Profile Dropdown -->
                        <ComboBox Grid.Column="1" Width="120" Margin="0,0,8,0"
                                  ItemsSource="{Binding Profiles}"
                                  SelectedItem="{Binding SelectedProfile}"
                                  DisplayMemberPath="Name"
                                  VerticalAlignment="Center">
                            <ComboBox.Style>
                                <Style TargetType="ComboBox">
                                    <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
                                    <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
                                    <Setter Property="FontSize" Value="11" />
                                </Style>
                            </ComboBox.Style>
                            <ComboBox.ItemContainerStyle>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
                                    <Setter Property="Padding" Value="8,4" />
                                    <Style.Triggers>
                                        <Trigger Property="IsHighlighted" Value="True">
                                            <Setter Property="Background" Value="{StaticResource AccentBrush}" />
                                            <Setter Property="Foreground" Value="White" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ComboBox.ItemContainerStyle>
                            <ComboBox.Resources>
                                <Style TargetType="Popup">
                                    <Setter Property="AllowsTransparency" Value="True" />
                                </Style>
                                <Style TargetType="Border" x:Key="{x:Type ComboBox}">
                                    <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}" />
                                </Style>
                            </ComboBox.Resources>
                        </ComboBox>

                        <!-- Refresh Button -->
                        <Button Grid.Column="2" Style="{StaticResource IconButton}"
                                Command="{Binding RefreshMonitorsCommand}" ToolTip="Refresh monitors"
                                Margin="0,0,4,0">
                            <TextBlock Text="&#x21BB;" FontSize="16" />
                        </Button>

                        <!-- Settings Button -->
                        <Button Grid.Column="3" Style="{StaticResource IconButton}"
                                Command="{Binding ToggleSettingsCommand}" ToolTip="Settings">
                            <TextBlock Text="&#x2699;" FontSize="16" />
                        </Button>
                    </Grid>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
